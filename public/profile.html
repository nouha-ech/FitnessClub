<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Compte</title>
    <link rel="stylesheet" href="compte.css">
</head>
<body>
    <header>
        <br>
    </header>
    <br><br>

    <div class="account-container">
        <h4>Mon Compte</h4>
        <hr>
        <form id="account-form">
            <div>
                <br><br>
                <label for="nom">Nom</label>
                <input type="text" id="nom" name="nom" placeholder="Nom" disabled>
            </div>
            <div>
                <label for="prenom">Prénom</label>
                <input type="text" id="prenom" name="prenom" placeholder="Prénom" disabled>
            </div>
            <div>
                <label for="telephone">Numéro de téléphone</label>
                <input type="text" id="telephone" name="telephone" placeholder="Téléphone" disabled>
            </div>
            <div>
                <label for="email">Email</label>
                <input type="email" id="email" name="email" placeholder="Email" disabled>
            </div>

            <button type="button" id="modifier-btn" onclick="enableEditing()">Modifier Info</button>
            <button type="button" id="save-btn" style="display: none;" onclick="saveInfo()">Sauvegarder</button>
        </form>
        <div id="update-messages"></div>
    </div>

    <script>
        // Fetch user info and populate placeholders (array-based logic)
        window.onload = async function() {
            try {
                const response = await fetch("/getUserInfo");
                const userInfoArray = await response.json();

                // Log the array and the first object to check its content
                console.log("API Response:", userInfoArray);
                console.log("First User Info Object:", userInfoArray[0]);

                if (response.ok && userInfoArray.length > 0) {
                    const userInfo = userInfoArray[0]; // Use the first object of the array

                    // Populate the form with user info as placeholders
                    document.getElementById("nom").placeholder = userInfo.nom || "Nom";
                    document.getElementById("prenom").placeholder = userInfo.prenom || "Prénom";
                    document.getElementById("telephone").placeholder = userInfo.telephone || "Téléphone";
                    document.getElementById("email").placeholder = userInfo.email || "Email";

                    // Also set the input values (to be used when editing)
                    document.getElementById("nom").value = userInfo.nom || "";
                    document.getElementById("prenom").value = userInfo.prenom || "";
                    document.getElementById("telephone").value = userInfo.telephone || "";
                    document.getElementById("email").value = userInfo.email || "";

                } else {
                    document.getElementById("update-messages").innerText = "Erreur de chargement des informations";
                }
            } catch (error) {
                document.getElementById("update-messages").innerText = "Erreur: " + error.message;
            }
        };

        // Enable form fields for editing
 // Enable form fields for editing
function enableEditing() {
    // Enable all the input fields to allow editing
    document.getElementById("nom").disabled = false;
    document.getElementById("prenom").disabled = false;
    document.getElementById("telephone").disabled = false;
    document.getElementById("email").disabled = false;
    
    // Hide the "Modifier Info" button and show the "Sauvegarder" button
    document.getElementById("modifier-btn").style.display = "none";
    document.getElementById("save-btn").style.display = "block";
}

// Save updated user info
async function saveInfo() {

    const nom = document.getElementById("nom").value;
    const prenom = document.getElementById("prenom").value;
    const telephone = document.getElementById("telephone").value;
    const email = document.getElementById("email").value;

    try {
        const response = await fetch(`/updateUserInfo`, { // Use userId in URL
            method: "PATCH",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ nom, prenom, telephone, email }) // Send updated user info
        });

        if (!response.ok) throw new Error("Failed to update user info");

        document.getElementById("update-messages").innerText = "Informations mises à jour avec succès!";
        
        // Disable the form fields after saving
        document.getElementById("nom").disabled = true;
        document.getElementById("prenom").disabled = true;
        document.getElementById("telephone").disabled = true;
        document.getElementById("email").disabled = true;

        // Show the "Modifier Info" button and hide the "Sauvegarder" button
        document.getElementById("modifier-btn").style.display = "block";
        document.getElementById("save-btn").style.display = "none";

    } catch (error) {
        document.getElementById("update-messages").innerText = "Erreur: " + error.message;
    }
}

    </script>
</body>
</html>
